const links = Array.from(document.querySelectorAll(".navlink"));
const sections = links
  .map(a => document.querySelector(a.getAttribute("href")))
  .filter(Boolean);

// Smooth scroll on click (optional; CSS scroll-behavior already does it)
links.forEach(link => {
  link.addEventListener("click", (e) => {
    const id = link.getAttribute("href");
    const target = document.querySelector(id);
    if (!target) return;

    e.preventDefault();
    target.scrollIntoView({ behavior: "smooth", block: "start" });

    history.replaceState(null, "", id);
  });
});

// Highlight the nav item for the section currently in view
const observer = new IntersectionObserver(
  (entries) => {
    // pick the most visible section in viewport
    const visible = entries
      .filter(e => e.isIntersecting)
      .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];

    if (!visible) return;

    const id = "#" + visible.target.id;
    links.forEach(a => a.classList.toggle("active", a.getAttribute("href") === id));
  },
  {
    root: null,
    // topbar takes space; this helps pick the correct section
    rootMargin: "-35% 0px -55% 0px",
    threshold: [0.15, 0.25, 0.35, 0.5, 0.65]
  }
);

sections.forEach(sec => observer.observe(sec));
